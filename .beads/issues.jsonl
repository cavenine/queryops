{"id":"queryops-02p","title":"Fix G115 issues","description":"Address potential integer overflow in integer conversions in user repository and counter handlers","status":"closed","priority":0,"issue_type":"task","created_at":"2025-12-17T23:01:00.478413872-05:00","updated_at":"2025-12-17T23:22:02.506436818-05:00","closed_at":"2025-12-17T23:22:02.506436818-05:00","dependencies":[{"issue_id":"queryops-02p","depends_on_id":"queryops-8tj","type":"parent-child","created_at":"2025-12-17T23:01:03.343104437-05:00","created_by":"daemon"}]}
{"id":"queryops-05n","title":"Create account settings page","description":"New settings.templ page at /account. Lists user info (email) and registered passkeys with names/dates. Include 'Add Passkey' button and 'Remove' buttons for each credential.","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-12T17:27:28.598024432-05:00","updated_at":"2025-12-12T19:29:51.893030563-05:00","closed_at":"2025-12-12T19:29:51.893030563-05:00","dependencies":[{"issue_id":"queryops-05n","depends_on_id":"queryops-pux","type":"parent-child","created_at":"2025-12-12T17:27:45.175300588-05:00","created_by":"daemon"}]}
{"id":"queryops-0kg","title":"gofmt import grouping for organization_service.go","description":"features/organization/services/organization_service.go imports are not grouped/ordered per gofmt + repo conventions.\n\nProposed fix: run gofmt (or reorder imports) to match stdlib / external / internal grouping.\n\nTouch points: features/organization/services/organization_service.go","status":"closed","priority":4,"issue_type":"chore","created_at":"2025-12-19T14:29:26.335073185-05:00","updated_at":"2025-12-19T14:43:47.785140839-05:00","closed_at":"2025-12-19T14:43:47.785140839-05:00","close_reason":"Closed","labels":["severity:low"]}
{"id":"queryops-195","title":"Add Kamal migration hook","description":"Add .kamal/hooks/pre-deploy (or pre-app-boot) to run '/main migrate up' on primary host using new image version; disable AUTO_MIGRATE in deploy env.","status":"closed","priority":1,"issue_type":"feature","created_at":"2025-12-12T21:10:11.364379908-05:00","updated_at":"2025-12-12T21:14:11.990025821-05:00","closed_at":"2025-12-12T21:14:11.990025821-05:00","dependencies":[{"issue_id":"queryops-195","depends_on_id":"queryops-1ox","type":"parent-child","created_at":"2025-12-12T21:10:22.141108458-05:00","created_by":"daemon"}]}
{"id":"queryops-1cm","title":"Add /up healthcheck endpoint","description":"Expose unauthenticated GET /up returning 200 when ready (ideally with DB ping) so kamal-proxy healthcheck works.","status":"closed","priority":0,"issue_type":"feature","created_at":"2025-12-12T21:10:08.742053169-05:00","updated_at":"2025-12-12T21:14:05.66874881-05:00","closed_at":"2025-12-12T21:14:05.66874881-05:00","dependencies":[{"issue_id":"queryops-1cm","depends_on_id":"queryops-1ox","type":"parent-child","created_at":"2025-12-12T21:10:21.559927082-05:00","created_by":"daemon"}]}
{"id":"queryops-1mc","title":"Implement enroll secret rotation (single active secret)","description":"Org creation inserts a new active enroll secret but does not deactivate old secrets.\n\nImpact: secrets cannot be revoked; old secrets remain usable indefinitely after leak/rotation.\n\nProposed fix: deactivate previous secrets for org in same transaction when adding a new one; optionally enforce one-active-secret constraint.\n\nTouch points: features/organization/services/organization_repository.go AddEnrollSecret(), migrations/sql/20251219011627_organizations.*.sql","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-19T14:29:17.022238177-05:00","updated_at":"2025-12-19T14:37:45.175023724-05:00","closed_at":"2025-12-19T14:37:45.175023724-05:00","close_reason":"Closed","labels":["severity:medium"]}
{"id":"queryops-1ox","title":"Deploy QueryOps on DigitalOcean with Kamal","description":"","status":"closed","priority":0,"issue_type":"feature","created_at":"2025-12-12T21:10:02.696030122-05:00","updated_at":"2025-12-17T22:11:06.531139252-05:00","closed_at":"2025-12-17T22:11:06.531139252-05:00"}
{"id":"queryops-1sa","title":"Write DigitalOcean + Kamal deployment runbook","description":"Document droplet setup, firewall/ports, DNS, secrets, kamal setup/deploy, rollback, logs, and troubleshooting.","status":"closed","priority":1,"issue_type":"chore","created_at":"2025-12-12T21:10:17.605411895-05:00","updated_at":"2025-12-12T21:14:14.514092247-05:00","closed_at":"2025-12-12T21:14:14.514092247-05:00","dependencies":[{"issue_id":"queryops-1sa","depends_on_id":"queryops-1ox","type":"parent-child","created_at":"2025-12-12T21:10:22.458968356-05:00","created_by":"daemon"}]}
{"id":"queryops-2ia","title":"Fix errcheck issues","description":"Address unchecked errors in router/router.go and cmd/web/build/main.go","status":"closed","priority":0,"issue_type":"task","created_at":"2025-12-17T23:01:00.446187181-05:00","updated_at":"2025-12-17T23:09:19.758707416-05:00","closed_at":"2025-12-17T23:09:19.758707416-05:00","dependencies":[{"issue_id":"queryops-2ia","depends_on_id":"queryops-8tj","type":"parent-child","created_at":"2025-12-17T23:01:03.313690045-05:00","created_by":"daemon"}]}
{"id":"queryops-3es","title":"Build project locally","description":"","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-11T22:05:09.402256306-05:00","updated_at":"2025-12-12T17:29:28.192266727-05:00","closed_at":"2025-12-12T17:29:28.192266727-05:00"}
{"id":"queryops-3j2","title":"Create user_credentials migration","description":"Migration to create user_credentials table for storing WebAuthn credentials. Includes credential_id, public_key, attestation_type, transports, flags, authenticator info, and timestamps.","status":"closed","priority":1,"issue_type":"task","created_at":"2025-12-12T17:26:05.652852407-05:00","updated_at":"2025-12-12T17:32:00.881683257-05:00","closed_at":"2025-12-12T17:32:00.881683257-05:00","dependencies":[{"issue_id":"queryops-3j2","depends_on_id":"queryops-a05","type":"parent-child","created_at":"2025-12-12T17:27:23.605775168-05:00","created_by":"daemon"}]}
{"id":"queryops-7xm","title":"Add passkey naming on registration","description":"Allow users to name their passkey when adding it (e.g., 'MacBook Pro', 'iPhone'). Add nickname column to user_credentials table. Show names in settings page.","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-12T17:27:32.610778644-05:00","updated_at":"2025-12-12T19:29:55.294962907-05:00","closed_at":"2025-12-12T19:29:55.294962907-05:00","dependencies":[{"issue_id":"queryops-7xm","depends_on_id":"queryops-pux","type":"parent-child","created_at":"2025-12-12T17:27:45.191468045-05:00","created_by":"daemon"},{"issue_id":"queryops-7xm","depends_on_id":"queryops-05n","type":"blocks","created_at":"2025-12-12T17:27:52.440790599-05:00","created_by":"daemon"}]}
{"id":"queryops-8tj","title":"Category 1: Security \u0026 Bug Prevention","description":"Fix high priority issues including errcheck, gosec (G301, G107, G112), nilnil, and G115 (integer overflow).","status":"closed","priority":0,"issue_type":"task","created_at":"2025-12-17T23:00:45.086043689-05:00","updated_at":"2025-12-17T23:22:17.886181738-05:00","closed_at":"2025-12-17T23:22:17.886181738-05:00","dependencies":[{"issue_id":"queryops-8tj","depends_on_id":"queryops-hxq","type":"parent-child","created_at":"2025-12-17T23:00:52.010420999-05:00","created_by":"daemon"}]}
{"id":"queryops-90d","title":"Provision DO droplet + DNS records","description":"Create Ubuntu droplet, attach domain, open 80/443/22, and verify SSH access for Kamal.","status":"closed","priority":1,"issue_type":"chore","created_at":"2025-12-12T21:10:13.614171982-05:00","updated_at":"2025-12-17T22:11:06.532048758-05:00","closed_at":"2025-12-17T22:11:06.532048758-05:00","dependencies":[{"issue_id":"queryops-90d","depends_on_id":"queryops-1ox","type":"parent-child","created_at":"2025-12-12T21:10:23.282189062-05:00","created_by":"daemon"}]}
{"id":"queryops-92q","title":"Remove stray fmt.Println from osquery Logger","description":"features/osquery/handlers.go Logger currently prints raw status log lines via fmt.Println, which pollutes stdout/logs and may leak data. Remove this debug statement.","acceptance_criteria":"No fmt.Println in Logger; behavior otherwise unchanged; go test ./... passes.","status":"closed","priority":2,"issue_type":"bug","created_at":"2025-12-20T16:03:23.70482437-05:00","updated_at":"2025-12-20T16:51:15.20438251-05:00","closed_at":"2025-12-20T16:51:15.20438251-05:00","close_reason":"Implemented DI-friendly osquery handlers, removed stray fmt.Println, and added httptest coverage for enroll/config/logger/distributed read+write; go test ./... passes.","dependencies":[{"issue_id":"queryops-92q","depends_on_id":"queryops-xzb","type":"discovered-from","created_at":"2025-12-20T16:03:23.707596616-05:00","created_by":"daemon"}]}
{"id":"queryops-9ea","title":"Harden index template against nil org when showing enroll secret","description":"Index template renders enroll secret block when enrollSecret != \"\", but interpolates org.Name inside that block.\n\nCurrently the handler only sets enrollSecret when org != nil, but the template is brittle if future logic changes.\n\nProposed fix: guard on (org != nil \u0026\u0026 enrollSecret != \"\").\n\nTouch points: features/index/pages/index.templ","status":"closed","priority":3,"issue_type":"bug","created_at":"2025-12-19T14:29:20.075862745-05:00","updated_at":"2025-12-19T14:39:06.100519576-05:00","closed_at":"2025-12-19T14:39:06.100519576-05:00","close_reason":"Closed","labels":["severity:low"]}
{"id":"queryops-9pe","title":"Add navigation link to account settings","description":"Update navigation.templ to include link to /account settings page. Show in navbar when user is logged in.","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-12T17:27:40.74951122-05:00","updated_at":"2025-12-12T19:29:55.321869075-05:00","closed_at":"2025-12-12T19:29:55.321869075-05:00","dependencies":[{"issue_id":"queryops-9pe","depends_on_id":"queryops-pux","type":"parent-child","created_at":"2025-12-12T17:27:45.21457061-05:00","created_by":"daemon"},{"issue_id":"queryops-9pe","depends_on_id":"queryops-05n","type":"blocks","created_at":"2025-12-12T17:27:52.46796728-05:00","created_by":"daemon"}]}
{"id":"queryops-a05","title":"Passkey Authentication - Phase 1","description":"Add passkey (WebAuthn) support for existing users. Users can add passkeys to their account and use them to log in. Includes: database migration for credentials table, WebAuthn service, passkey handlers, and login page updates.","status":"closed","priority":1,"issue_type":"feature","created_at":"2025-12-12T17:25:57.294516684-05:00","updated_at":"2025-12-12T17:37:57.531422199-05:00","closed_at":"2025-12-12T17:37:57.531422199-05:00"}
{"id":"queryops-a4f","title":"Explore app endpoints and pages","description":"","status":"closed","priority":3,"issue_type":"task","created_at":"2025-12-11T22:06:45.930944542-05:00","updated_at":"2025-12-12T17:29:28.194294851-05:00","closed_at":"2025-12-12T17:29:28.194294851-05:00"}
{"id":"queryops-ap3","title":"Prevent cross-org host takeover via enroll upsert","description":"Enrollment upserts on host_identifier and updates organization_id + node_key.\n\nScenario: host identifiers are often guessable; anyone with any valid org enroll secret can re-enroll an existing host_identifier and move it into their org (rotating node_key).\n\nFix options: (1) Make host_identifier unique per org: UNIQUE(organization_id, host_identifier) and upsert on that; or (2) keep global uniqueness and reject enrollment if the existing host belongs to a different org.\n\nTouch points: migrations/sql/*hosts*.sql, features/osquery/services/host_repository.go Enroll().","status":"closed","priority":0,"issue_type":"bug","created_at":"2025-12-19T14:29:00.050126952-05:00","updated_at":"2025-12-19T14:36:09.759307498-05:00","closed_at":"2025-12-19T14:36:09.759307498-05:00","close_reason":"Closed","labels":["severity:high"]}
{"id":"queryops-bex","title":"Avoid confusing import shadowing in navigation template","description":"features/common/components/navigation.templ imports organization/components as \"components\" inside package \"components\".\n\nImpact: readability hazard; easy to confuse local package vs imported package.\n\nProposed fix: alias import (e.g., orgcomponents) and update usages.\n\nTouch points: features/common/components/navigation.templ","status":"closed","priority":4,"issue_type":"chore","created_at":"2025-12-19T14:29:23.412063269-05:00","updated_at":"2025-12-19T14:42:58.825527151-05:00","closed_at":"2025-12-19T14:42:58.825527151-05:00","close_reason":"Closed","labels":["severity:low"]}
{"id":"queryops-bgk","title":"Use golang:1.25.5-trixie for builds","description":"Switch Dockerfile build stage to golang:1.25.5-trixie to align with glibc Debian Trixie base.","status":"closed","priority":1,"issue_type":"chore","created_at":"2025-12-12T21:53:53.23850147-05:00","updated_at":"2025-12-12T21:55:01.85641462-05:00","closed_at":"2025-12-12T21:55:01.85641462-05:00","dependencies":[{"issue_id":"queryops-bgk","depends_on_id":"queryops-1ox","type":"parent-child","created_at":"2025-12-12T21:53:57.925105809-05:00","created_by":"daemon"}]}
{"id":"queryops-bro","title":"Add db package and migrations","description":"","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-11T22:39:42.973473092-05:00","updated_at":"2025-12-12T17:29:28.190126321-05:00","closed_at":"2025-12-12T17:29:28.190126321-05:00"}
{"id":"queryops-cjt","title":"Add GitHub Actions workflow to run tests on PR","description":"","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-20T16:58:44.508961558-05:00","updated_at":"2025-12-20T16:59:16.628114821-05:00","closed_at":"2025-12-20T16:59:16.628114821-05:00","close_reason":"Added GitHub Actions workflow .github/workflows/tests.yml to run go tool task test:all on pull_request using actions/checkout@v5 and actions/setup-go@v6 (go-version-file)."}
{"id":"queryops-cp4","title":"Add Taskfile tasks for unit + integration tests","description":"","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-20T16:54:17.138616811-05:00","updated_at":"2025-12-20T16:54:42.628264027-05:00","closed_at":"2025-12-20T16:54:42.628264027-05:00","close_reason":"Added Taskfile tasks test, test:integration, and test:all for running go test ./..., the Testcontainers suite, and both together."}
{"id":"queryops-d4s","title":"Add Testcontainers Postgres integration test harness","description":"Introduce integration testing for Postgres using Testcontainers for Go (Go 1.25, Postgres 18.x, pgx v5). Provide a reusable helper that spins up an ephemeral Postgres container, runs app + River migrations, exposes a pgxpool, and cleans up via t.Cleanup.","design":"Use testcontainers-go modules/postgres with image postgres:18.1-bookworm. Wait for readiness with wait.ForListeningPort(5432/tcp) + wait.ForLog('database system is ready to accept connections' occurrence=2). Build DSN using container.Host + container.MappedPort (no hardcoded 5432). Connect via pgxpool with sslmode=disable; call Ping. Apply migrations via migrations.Up(dsn) (golang-migrate with embedded iofs). Apply River migrations via rivermigrate.New(riverpgxv5.New(pool)). Provide sample SELECT 1 test. Consider gating integration tests behind build tags or env checks to avoid failures when Docker unavailable.","acceptance_criteria":"Helper exists and is used by at least one integration test; migrations applied; go test ./... passes in envs with Docker; tests skip gracefully when Docker unavailable.","status":"closed","priority":1,"issue_type":"epic","created_at":"2025-12-20T16:16:25.893036748-05:00","updated_at":"2025-12-20T16:53:03.956716573-05:00","closed_at":"2025-12-20T16:53:03.956716573-05:00","close_reason":"Implemented Testcontainers Postgres integration harness (migrations + River), optional reuse mode with per-test cloned DBs, and documented usage; integration tests skip when Docker unavailable."}
{"id":"queryops-d4s.1","title":"Add testdb helper using Testcontainers Postgres","description":"Create a reusable SetupTestDB(t) helper that starts postgres:18.1-bookworm via testcontainers-go modules/postgres, returns a pgxpool, and registers cleanup with t.Cleanup.","design":"Package: internal/testdb or testing/testdb (pick one and document). Struct TestDB { Container *postgres.PostgresContainer; Pool *pgxpool.Pool; DSN/Host/Port/User/Password/Database }. SetupTestDB: start container w/ wait strategy, discover host+mapped port, build DSN with sslmode=disable, create pgxpool, Ping. On container start failure (Docker missing), t.Skipf. Ensure pool.Close and container.Terminate via t.Cleanup.","acceptance_criteria":"Helper compiles and can be used in tests; no hardcoded ports; lifecycle handled via t.Cleanup.","notes":"Implemented internal/testdb SetupTestDB using postgres:18.1-bookworm, dynamic mapped port DSN, pgxpool Ping, and t.Cleanup lifecycle.","status":"closed","priority":1,"issue_type":"task","created_at":"2025-12-20T16:16:35.817923198-05:00","updated_at":"2025-12-20T16:20:27.576989352-05:00","closed_at":"2025-12-20T16:20:27.576992266-05:00","dependencies":[{"issue_id":"queryops-d4s.1","depends_on_id":"queryops-d4s","type":"parent-child","created_at":"2025-12-20T16:16:35.825486475-05:00","created_by":"daemon"}]}
{"id":"queryops-d4s.10","title":"Enable parallel tests with reused container","description":"Allow QUERYOPS_TESTDB_REUSE mode to support parallel tests by creating a per-test database cloned from the migrated snapshot template, instead of restoring a shared database.","design":"Keep container reuse by name. Ensure snapshot template DB exists once (serialized). For each SetupTestDB call: create dbName=test_\u003cuuid\u003e, CREATE DATABASE dbName WITH TEMPLATE snapshotName OWNER test, connect pgxpool to that DB, and t.Cleanup drop it (DROP DATABASE ... WITH (FORCE)). Remove global reuse lock so tests can run concurrently.","acceptance_criteria":"With QUERYOPS_TESTDB_REUSE=1, ?   \tgithub.com/cavenine/queryops/background\t[no test files]\n?   \tgithub.com/cavenine/queryops/cmd\t[no test files]\n?   \tgithub.com/cavenine/queryops/cmd/web\t[no test files]\n?   \tgithub.com/cavenine/queryops/cmd/web/build\t[no test files]\n?   \tgithub.com/cavenine/queryops/cmd/web/downloader\t[no test files]\n?   \tgithub.com/cavenine/queryops/config\t[no test files]\n?   \tgithub.com/cavenine/queryops/db\t[no test files]\n?   \tgithub.com/cavenine/queryops/features/account\t[no test files]\n?   \tgithub.com/cavenine/queryops/features/account/pages\t[no test files]\nok  \tgithub.com/cavenine/queryops/features/auth\t0.006s\n?   \tgithub.com/cavenine/queryops/features/auth/pages\t[no test files]\n?   \tgithub.com/cavenine/queryops/features/auth/services\t[no test files]\n?   \tgithub.com/cavenine/queryops/features/common/components\t[no test files]\n?   \tgithub.com/cavenine/queryops/features/common/components/aspectratio\t[no test files]\n?   \tgithub.com/cavenine/queryops/features/common/components/button\t[no test files]\n?   \tgithub.com/cavenine/queryops/features/common/components/card\t[no test files]\n?   \tgithub.com/cavenine/queryops/features/common/components/dialog\t[no test files]\n?   \tgithub.com/cavenine/queryops/features/common/components/icon\t[no test files]\n?   \tgithub.com/cavenine/queryops/features/common/layouts\t[no test files]\n?   \tgithub.com/cavenine/queryops/features/counter\t[no test files]\n?   \tgithub.com/cavenine/queryops/features/counter/pages\t[no test files]\n?   \tgithub.com/cavenine/queryops/features/index\t[no test files]\n?   \tgithub.com/cavenine/queryops/features/index/components\t[no test files]\n?   \tgithub.com/cavenine/queryops/features/index/pages\t[no test files]\n?   \tgithub.com/cavenine/queryops/features/index/services\t[no test files]\n?   \tgithub.com/cavenine/queryops/features/monitor\t[no test files]\n?   \tgithub.com/cavenine/queryops/features/monitor/pages\t[no test files]\n?   \tgithub.com/cavenine/queryops/features/organization\t[no test files]\n?   \tgithub.com/cavenine/queryops/features/organization/components\t[no test files]\n?   \tgithub.com/cavenine/queryops/features/organization/pages\t[no test files]\n?   \tgithub.com/cavenine/queryops/features/organization/services\t[no test files]\nok  \tgithub.com/cavenine/queryops/features/osquery\t0.003s\n?   \tgithub.com/cavenine/queryops/features/osquery/pages\t[no test files]\n?   \tgithub.com/cavenine/queryops/features/osquery/services\t[no test files]\n?   \tgithub.com/cavenine/queryops/features/reverse\t[no test files]\n?   \tgithub.com/cavenine/queryops/features/reverse/pages\t[no test files]\n?   \tgithub.com/cavenine/queryops/features/sortable\t[no test files]\n?   \tgithub.com/cavenine/queryops/features/sortable/pages\t[no test files]\nok  \tgithub.com/cavenine/queryops/internal/antibot\t0.003s\nok  \tgithub.com/cavenine/queryops/internal/testdb\t1.712s\n?   \tgithub.com/cavenine/queryops/migrations\t[no test files]\n?   \tgithub.com/cavenine/queryops/router\t[no test files]\n?   \tgithub.com/cavenine/queryops/utils\t[no test files]\n?   \tgithub.com/cavenine/queryops/web/resources\t[no test files] works; parallel subtests in internal/testdb pass; no cross-test data leaks.","notes":"Reuse mode now supports parallel tests: snapshot init is serialized, but each SetupTestDB call clones a unique DB from the migrated template and drops it at cleanup. Added parallel subtest to validate.","status":"closed","priority":1,"issue_type":"task","created_at":"2025-12-20T16:35:42.703131212-05:00","updated_at":"2025-12-20T16:38:26.991941693-05:00","closed_at":"2025-12-20T16:38:26.991944829-05:00","dependencies":[{"issue_id":"queryops-d4s.10","depends_on_id":"queryops-d4s","type":"parent-child","created_at":"2025-12-20T16:35:42.703937324-05:00","created_by":"daemon"}]}
{"id":"queryops-d4s.11","title":"Add tests for reuse-mode isolation and cleanup","description":"Add integration tests that exercise QUERYOPS_TESTDB_REUSE behavior: per-test DB isolation via template cloning, and database drop on cleanup.","design":"In internal/testdb/testdb_test.go add tests that are skipped unless reuseEnabled(). 1) Create DB A, create a temp table, then create DB B and assert the temp table does not exist (to_regclass). 2) Use a subtest to create a DB and capture its name, then after subtest returns query pg_database from admin connection to ensure DB was dropped.","acceptance_criteria":"QUERYOPS_TESTDB_REUSE=1 go test ./internal/testdb passes and validates isolation; go test ./... passes by default.","notes":"Added reuse-mode tests: isolation between cloned DBs (temp table not shared) and DB drop on cleanup (pg_database check). All tests skip unless QUERYOPS_TESTDB_REUSE=1.","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-20T16:40:31.960460547-05:00","updated_at":"2025-12-20T16:41:13.392056638-05:00","closed_at":"2025-12-20T16:41:13.392059584-05:00","dependencies":[{"issue_id":"queryops-d4s.11","depends_on_id":"queryops-d4s","type":"parent-child","created_at":"2025-12-20T16:40:31.969151014-05:00","created_by":"daemon"}]}
{"id":"queryops-d4s.2","title":"Run app migrations inside test container","description":"Ensure SetupTestDB applies application migrations to the container so integration tests run against real schema.","design":"Reuse migrations.Up(dsn) (golang-migrate + embedded iofs). Ensure DSN uses postgres:// scheme and sslmode=disable. Fail test if migrations fail.","acceptance_criteria":"After SetupTestDB, schema_migrations exists and latest migration applied; tests can query app tables.","notes":"SetupTestDB now runs migrations.Up(dsn); added migrations/pgxstdlib.go to register sql driver for golang-migrate.","status":"closed","priority":1,"issue_type":"task","created_at":"2025-12-20T16:16:39.812004639-05:00","updated_at":"2025-12-20T16:20:28.086041668-05:00","closed_at":"2025-12-20T16:20:28.086045062-05:00","dependencies":[{"issue_id":"queryops-d4s.2","depends_on_id":"queryops-d4s","type":"parent-child","created_at":"2025-12-20T16:16:39.819494666-05:00","created_by":"daemon"}]}
{"id":"queryops-d4s.3","title":"Run River migrations inside test container","description":"Ensure SetupTestDB also applies River migrations to match production boot.","design":"Call rivermigrate.New(riverpgxv5.New(pool), nil) and migrator.Migrate(ctx, DirectionUp, nil).","acceptance_criteria":"River tables exist after SetupTestDB; no errors running migrator.","notes":"SetupTestDB applies River migrations via rivermigrate + riverpgxv5.","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-20T16:16:42.337002253-05:00","updated_at":"2025-12-20T16:20:28.474508452-05:00","closed_at":"2025-12-20T16:20:28.474511639-05:00","dependencies":[{"issue_id":"queryops-d4s.3","depends_on_id":"queryops-d4s","type":"parent-child","created_at":"2025-12-20T16:16:42.345133229-05:00","created_by":"daemon"}]}
{"id":"queryops-d4s.4","title":"Add sample integration test using SetupTestDB","description":"Add at least one integration test demonstrating the helper (e.g., SELECT 1) and verifying container + pool work.","design":"Add a _test.go file that calls SetupTestDB and runs a simple query. Keep it minimal and table-driven if multiple cases.","acceptance_criteria":"go test (with Docker) runs sample test successfully.","notes":"Added internal/testdb/testdb_test.go demonstrating SELECT 1 against the container DB.","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-20T16:16:45.039071304-05:00","updated_at":"2025-12-20T16:20:29.109247854-05:00","closed_at":"2025-12-20T16:20:29.109251202-05:00","dependencies":[{"issue_id":"queryops-d4s.4","depends_on_id":"queryops-d4s","type":"parent-child","created_at":"2025-12-20T16:16:45.046834556-05:00","created_by":"daemon"}]}
{"id":"queryops-d4s.5","title":"Decide and implement integration test gating","description":"Prevent CI/dev environments without Docker from failing go test ./... due to integration tests.","design":"Options: (A) build tags (//go:build integration) for container-based tests; (B) runtime skip when container startup fails (t.Skipf). Prefer runtime skip for minimal friction, optionally add build tag if CI policy requires.","acceptance_criteria":"In env without Docker, tests skip cleanly; in env with Docker, integration tests execute.","notes":"Gating implemented by t.Skipf when container startup fails (Docker unavailable).","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-20T16:16:48.241723766-05:00","updated_at":"2025-12-20T16:20:29.520599123-05:00","closed_at":"2025-12-20T16:20:29.520603464-05:00","dependencies":[{"issue_id":"queryops-d4s.5","depends_on_id":"queryops-d4s","type":"parent-child","created_at":"2025-12-20T16:16:48.249828708-05:00","created_by":"daemon"}]}
{"id":"queryops-d4s.6","title":"Add testcontainers-go dependency to go.mod","description":"Vendor in Testcontainers for Go and postgres module dependencies for integration tests.","design":"Add github.com/testcontainers/testcontainers-go and github.com/testcontainers/testcontainers-go/modules/postgres. Keep versions consistent and minimal.","acceptance_criteria":"go mod tidy produces clean go.mod/go.sum; build and tests succeed.","notes":"Added testcontainers-go v0.40.0 + modules/postgres; ran go mod tidy.","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-20T16:16:51.373821397-05:00","updated_at":"2025-12-20T16:20:27.045070435-05:00","closed_at":"2025-12-20T16:20:27.045073284-05:00","dependencies":[{"issue_id":"queryops-d4s.6","depends_on_id":"queryops-d4s","type":"parent-child","created_at":"2025-12-20T16:16:51.381278175-05:00","created_by":"daemon"}]}
{"id":"queryops-d4s.7","title":"Document integration test usage","description":"Add brief docs on how to run container-backed integration tests locally.","design":"Update existing docs or QUICK_REFERENCE with commands (e.g. go test ./... or go test -run TestName). Mention Docker required and Postgres image postgres:18.1-bookworm.","acceptance_criteria":"Docs mention how to run and what prerequisites exist.","notes":"Reuse mode implemented; docs can mention QUERYOPS_TESTDB_REUSE=1 once requested.","status":"closed","priority":3,"issue_type":"task","created_at":"2025-12-20T16:16:54.088209531-05:00","updated_at":"2025-12-20T16:52:56.145748592-05:00","closed_at":"2025-12-20T16:52:56.145748592-05:00","close_reason":"Documented how to run Testcontainers-backed integration tests (Docker prerequisite, postgres:18.1-bookworm, and optional QUERYOPS_TESTDB_REUSE mode) in docs/QUICK_REFERENCE.md.","dependencies":[{"issue_id":"queryops-d4s.7","depends_on_id":"queryops-d4s","type":"parent-child","created_at":"2025-12-20T16:16:54.094773227-05:00","created_by":"daemon"}]}
{"id":"queryops-d4s.8","title":"Add opt-in Testcontainers reuse mode","description":"Allow reusing the Postgres testcontainer between go test runs (experimental) when enabled via env var, while still dropping the database used by a test to keep isolation.","design":"Add QUERYOPS_TESTDB_REUSE=1 opt-in. When enabled, start container with testcontainers.WithReuseByName(\u003cfixed-name\u003e) so it persists across runs; do not Terminate in t.Cleanup. For isolation, create a unique database per SetupTestDB call (e.g. test_\u003cuuid\u003e), connect pool to it, run migrations + River migrations, and in t.Cleanup close pool then DROP DATABASE ... WITH (FORCE).","acceptance_criteria":"With reuse off, behavior unchanged (container terminated). With reuse on, container persists across runs but each test DB is created and dropped; go test ./... passes.","notes":"Added QUERYOPS_TESTDB_REUSE opt-in: reuses container by name and creates/drops a unique per-test database (migrations + River applied) while keeping container alive across runs.","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-20T16:27:33.697526581-05:00","updated_at":"2025-12-20T16:28:59.852741504-05:00","closed_at":"2025-12-20T16:28:59.852744489-05:00","dependencies":[{"issue_id":"queryops-d4s.8","depends_on_id":"queryops-d4s","type":"parent-child","created_at":"2025-12-20T16:27:33.70485303-05:00","created_by":"daemon"}]}
{"id":"queryops-d4s.9","title":"Add snapshot/restore to reused test DB","description":"Speed up QUERYOPS_TESTDB_REUSE mode by snapshotting the migrated database once and restoring it for each test instead of re-running migrations.","design":"When reuse enabled: ensure container has a template snapshot DB (default name migrated_template). On first run: create base DB, run app + River migrations, create snapshot via container.Snapshot(ctx). For each test: container.Restore(ctx) to reset DB state quickly, then hand out a pool to the restored DB. Keep per-test cleanup minimal (close pool only).","acceptance_criteria":"With QUERYOPS_TESTDB_REUSE=1, first run creates snapshot; subsequent tests restore without rerunning migrations; go test ./... passes.","notes":"Implemented snapshot+restore in QUERYOPS_TESTDB_REUSE mode: creates a migrated template snapshot once (after app + River migrations) and restores it before each test; added connection-drain retry for snapshot creation.","status":"closed","priority":1,"issue_type":"task","created_at":"2025-12-20T16:29:46.610511363-05:00","updated_at":"2025-12-20T16:34:11.55825259-05:00","closed_at":"2025-12-20T16:34:11.558255623-05:00","dependencies":[{"issue_id":"queryops-d4s.9","depends_on_id":"queryops-d4s","type":"parent-child","created_at":"2025-12-20T16:29:46.617425377-05:00","created_by":"daemon"}]}
{"id":"queryops-d6b","title":"Category 2: Logic \u0026 Correctness","description":"Address extensive variable shadowing (shadow) throughout the codebase to prevent subtle logic errors.","status":"closed","priority":1,"issue_type":"task","created_at":"2025-12-17T23:00:45.096982429-05:00","updated_at":"2025-12-17T23:22:48.732843568-05:00","closed_at":"2025-12-17T23:22:48.732843568-05:00","dependencies":[{"issue_id":"queryops-d6b","depends_on_id":"queryops-hxq","type":"parent-child","created_at":"2025-12-17T23:00:56.554191253-05:00","created_by":"daemon"},{"issue_id":"queryops-d6b","depends_on_id":"queryops-8tj","type":"blocks","created_at":"2025-12-17T23:00:56.592521247-05:00","created_by":"daemon"}]}
{"id":"queryops-d79","title":"Create credential repository","description":"New credential_repository.go with CRUD operations: Create, GetByUserID, GetByCredentialID, UpdateSignCount, Delete. Maps between webauthn.Credential and database rows.","status":"closed","priority":1,"issue_type":"task","created_at":"2025-12-12T17:26:14.114616743-05:00","updated_at":"2025-12-12T17:33:31.498781261-05:00","closed_at":"2025-12-12T17:33:31.498781261-05:00","dependencies":[{"issue_id":"queryops-d79","depends_on_id":"queryops-3j2","type":"blocks","created_at":"2025-12-12T17:27:07.85260157-05:00","created_by":"daemon"},{"issue_id":"queryops-d79","depends_on_id":"queryops-nck","type":"blocks","created_at":"2025-12-12T17:27:07.863720483-05:00","created_by":"daemon"},{"issue_id":"queryops-d79","depends_on_id":"queryops-a05","type":"parent-child","created_at":"2025-12-12T17:27:23.6446522-05:00","created_by":"daemon"}]}
{"id":"queryops-daa","title":"Add antibot checks to register form","description":"Add honeypot + JS token + timing antibot checks to /register (JS required, hard-block). Includes server-side validator, DataStar-compatible token injection JS, CSS utility, tests, and docs.","status":"closed","priority":2,"issue_type":"feature","created_at":"2025-12-13T21:27:05.828390583-05:00","updated_at":"2025-12-13T21:33:49.511583808-05:00","closed_at":"2025-12-13T21:33:49.511583808-05:00"}
{"id":"queryops-ehk","title":"Add Kamal config for web/worker/postgres","description":"Create config/deploy.yml for single-VM deploy: web role, workers role (proxy disabled), postgres accessory, env/secrets, and proxy settings.","status":"closed","priority":0,"issue_type":"feature","created_at":"2025-12-12T21:10:10.299057864-05:00","updated_at":"2025-12-12T21:14:08.909458879-05:00","closed_at":"2025-12-12T21:14:08.909458879-05:00","dependencies":[{"issue_id":"queryops-ehk","depends_on_id":"queryops-1ox","type":"parent-child","created_at":"2025-12-12T21:10:21.8980389-05:00","created_by":"daemon"}]}
{"id":"queryops-en2","title":"Category 3: Code Complexity \u0026 Maintenance","description":"Refactor high cognitive complexity handlers (gocognit) and remove unused parameters (revive).","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-17T23:00:45.107809589-05:00","updated_at":"2025-12-17T23:23:58.240146736-05:00","closed_at":"2025-12-17T23:23:58.240146736-05:00","dependencies":[{"issue_id":"queryops-en2","depends_on_id":"queryops-hxq","type":"parent-child","created_at":"2025-12-17T23:00:56.564128271-05:00","created_by":"daemon"},{"issue_id":"queryops-en2","depends_on_id":"queryops-d6b","type":"blocks","created_at":"2025-12-17T23:00:56.602921169-05:00","created_by":"daemon"}]}
{"id":"queryops-era","title":"Fix passkey options format for SimpleWebAuthn compatibility","description":"Return options.Response instead of full options struct to match SimpleWebAuthn expected format","status":"closed","priority":1,"issue_type":"bug","created_at":"2025-12-12T17:56:59.026842473-05:00","updated_at":"2025-12-12T17:56:59.049392766-05:00","closed_at":"2025-12-12T17:56:59.049392766-05:00"}
{"id":"queryops-eu3","title":"Category 5: Style \u0026 Formatting","description":"Fix low priority issues: goimports, godot, mnd (magic numbers), perfsprint, and intrange.","status":"closed","priority":4,"issue_type":"task","created_at":"2025-12-17T23:00:45.12879872-05:00","updated_at":"2025-12-19T14:33:03.976447187-05:00","closed_at":"2025-12-19T14:33:03.976447187-05:00","close_reason":"Closed","dependencies":[{"issue_id":"queryops-eu3","depends_on_id":"queryops-hxq","type":"parent-child","created_at":"2025-12-17T23:00:56.583283826-05:00","created_by":"daemon"},{"issue_id":"queryops-eu3","depends_on_id":"queryops-ks4","type":"blocks","created_at":"2025-12-17T23:00:56.622855491-05:00","created_by":"daemon"}]}
{"id":"queryops-f1b","title":"Fix Dockerfile for Kamal (alpine runtime)","description":"Update Dockerfile to build ./cmd binary, run 'web' by default, and use alpine runtime (not scratch) to support kamal exec/hooks.","status":"closed","priority":0,"issue_type":"chore","created_at":"2025-12-12T21:10:07.882086018-05:00","updated_at":"2025-12-12T21:14:03.701568202-05:00","closed_at":"2025-12-12T21:14:03.701568202-05:00","dependencies":[{"issue_id":"queryops-f1b","depends_on_id":"queryops-1ox","type":"parent-child","created_at":"2025-12-12T21:10:21.168434245-05:00","created_by":"daemon"}]}
{"id":"queryops-ghr","title":"Confirm untracked assets/rules are intended for this change","description":"Working tree includes new untracked directories/files (screenshots, rules, sgconfig.yml).\n\nImpact: potentially large/noisy diffs; may be accidental commit payload.\n\nProposed action: confirm which are intentional; exclude from commits or relocate if not.\n\nTouch points: registration_flow_screenshots/, rules/, rule-tests/, sgconfig.yml","status":"closed","priority":3,"issue_type":"chore","created_at":"2025-12-19T14:29:29.907478162-05:00","updated_at":"2025-12-19T14:41:52.087783765-05:00","closed_at":"2025-12-19T14:41:52.087783765-05:00","close_reason":"Closed","labels":["severity:low"]}
{"id":"queryops-gy9","title":"Differentiate invalid enroll secret vs backend errors","description":"Enroll currently treats (err != nil) the same as (secret not found) and returns NodeInvalid.\n\nImpact: transient DB errors appear as \"invalid secret\", slowing diagnosis and causing misleading client behavior.\n\nProposed fix: distinguish not-found from unexpected errors; return 500 on unexpected errors, NodeInvalid only on not-found.\n\nTouch points: features/osquery/handlers.go Enroll(), features/organization/services/organization_repository.go GetOrganizationByEnrollSecret().","status":"closed","priority":2,"issue_type":"bug","created_at":"2025-12-19T14:29:07.013855283-05:00","updated_at":"2025-12-19T14:36:09.795539505-05:00","closed_at":"2025-12-19T14:36:09.795539505-05:00","close_reason":"Closed","labels":["severity:medium"]}
{"id":"queryops-hxq","title":"Triage and fix golangci-lint failures","description":"","status":"closed","priority":0,"issue_type":"epic","created_at":"2025-12-17T23:00:40.505283518-05:00","updated_at":"2025-12-19T14:33:03.994326088-05:00","closed_at":"2025-12-19T14:33:03.994326088-05:00","close_reason":"Closed"}
{"id":"queryops-jgq","title":"Update login page with passkey support","description":"Modify login.templ to add 'Sign in with Passkey' button. Include SimpleWebAuthn browser library from CDN. Add inline JS to handle passkey flow: call /passkey/login/begin, invoke startAuthentication(), call /passkey/login/finish, redirect on success.","status":"closed","priority":1,"issue_type":"task","created_at":"2025-12-12T17:26:26.908684981-05:00","updated_at":"2025-12-12T17:37:49.331239037-05:00","closed_at":"2025-12-12T17:37:49.331239037-05:00","dependencies":[{"issue_id":"queryops-jgq","depends_on_id":"queryops-vde","type":"blocks","created_at":"2025-12-12T17:27:18.706737835-05:00","created_by":"daemon"},{"issue_id":"queryops-jgq","depends_on_id":"queryops-a05","type":"parent-child","created_at":"2025-12-12T17:27:23.678027009-05:00","created_by":"daemon"}]}
{"id":"queryops-ks4","title":"Category 4: Project Standards","description":"Address gochecknoglobals (especially Lucide icons), gochecknoinits, and forbidigo (fmt.Printf).","status":"closed","priority":3,"issue_type":"task","created_at":"2025-12-17T23:00:45.118313551-05:00","updated_at":"2025-12-19T14:33:03.956220453-05:00","closed_at":"2025-12-19T14:33:03.956220453-05:00","close_reason":"Closed","dependencies":[{"issue_id":"queryops-ks4","depends_on_id":"queryops-hxq","type":"parent-child","created_at":"2025-12-17T23:00:56.573856955-05:00","created_by":"daemon"},{"issue_id":"queryops-ks4","depends_on_id":"queryops-en2","type":"blocks","created_at":"2025-12-17T23:00:56.612607086-05:00","created_by":"daemon"}]}
{"id":"queryops-lww","title":"Add organization_id to Host model and repository queries","description":"Schema adds hosts.organization_id but Host model/queries do not select or scan it.\n\nImpact: cannot reliably enforce tenancy in handlers/repo; org checks become impossible or error-prone.\n\nProposed fix: add OrganizationID to services.Host; include organization_id in SELECT/Scan; add org-scoped repo methods (ListByOrganization, GetByIDAndOrg, etc.).\n\nTouch points: features/osquery/services/host_repository.go, related templates/handlers as needed.","status":"closed","priority":1,"issue_type":"task","created_at":"2025-12-19T14:29:10.601400029-05:00","updated_at":"2025-12-19T14:36:12.69990635-05:00","closed_at":"2025-12-19T14:36:12.69990635-05:00","close_reason":"Closed","labels":["severity:high"]}
{"id":"queryops-meg","title":"Add passkey removal functionality","description":"DELETE /passkey/{id} endpoint to remove a passkey. Require at least one auth method remains (password or another passkey). Update settings page to call this endpoint.","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-12T17:27:36.829186901-05:00","updated_at":"2025-12-12T19:29:55.310754379-05:00","closed_at":"2025-12-12T19:29:55.310754379-05:00","dependencies":[{"issue_id":"queryops-meg","depends_on_id":"queryops-pux","type":"parent-child","created_at":"2025-12-12T17:27:45.203765329-05:00","created_by":"daemon"},{"issue_id":"queryops-meg","depends_on_id":"queryops-05n","type":"blocks","created_at":"2025-12-12T17:27:52.454570845-05:00","created_by":"daemon"}]}
{"id":"queryops-nck","title":"Update User model for WebAuthn interface","description":"Modify User struct and repository to implement webauthn.User interface: WebAuthnID(), WebAuthnName(), WebAuthnDisplayName(), WebAuthnCredentials(). Add methods to load credentials for a user.","status":"closed","priority":1,"issue_type":"task","created_at":"2025-12-12T17:26:09.907341802-05:00","updated_at":"2025-12-12T17:32:46.930669692-05:00","closed_at":"2025-12-12T17:32:46.930669692-05:00","dependencies":[{"issue_id":"queryops-nck","depends_on_id":"queryops-3j2","type":"blocks","created_at":"2025-12-12T17:27:07.837765127-05:00","created_by":"daemon"},{"issue_id":"queryops-nck","depends_on_id":"queryops-a05","type":"parent-child","created_at":"2025-12-12T17:27:23.630801989-05:00","created_by":"daemon"}]}
{"id":"queryops-pbr","title":"Stop logging raw enrollment secrets","description":"The osquery enroll handler logs the provided enroll secret value when invalid.\n\nImpact: enrollment secrets can leak via log aggregation or operator access.\n\nProposed fix: remove the secret from logs, or log only a short prefix / hash.\n\nTouch points: features/osquery/handlers.go Enroll().","status":"closed","priority":1,"issue_type":"bug","created_at":"2025-12-19T14:29:03.224760786-05:00","updated_at":"2025-12-19T14:36:09.777457646-05:00","closed_at":"2025-12-19T14:36:09.777457646-05:00","close_reason":"Closed","labels":["severity:high"]}
{"id":"queryops-pn9","title":"Create WebAuthn service","description":"New webauthn_service.go that initializes go-webauthn/webauthn library with RPID and origins. Implements BeginRegistration, FinishRegistration, BeginLogin, FinishLogin. Uses SCS session to store WebAuthn session data (challenges).","status":"closed","priority":1,"issue_type":"task","created_at":"2025-12-12T17:26:18.39293392-05:00","updated_at":"2025-12-12T17:35:06.649189578-05:00","closed_at":"2025-12-12T17:35:06.649189578-05:00","dependencies":[{"issue_id":"queryops-pn9","depends_on_id":"queryops-d79","type":"blocks","created_at":"2025-12-12T17:27:11.468772527-05:00","created_by":"daemon"},{"issue_id":"queryops-pn9","depends_on_id":"queryops-nck","type":"blocks","created_at":"2025-12-12T17:27:11.487992757-05:00","created_by":"daemon"},{"issue_id":"queryops-pn9","depends_on_id":"queryops-a05","type":"parent-child","created_at":"2025-12-12T17:27:23.655899795-05:00","created_by":"daemon"}]}
{"id":"queryops-pux","title":"Passkey Authentication - Phase 2","description":"Account settings page for managing passkeys. Users can view registered passkeys, add new ones, and remove existing ones. Polish and UX improvements.","status":"closed","priority":2,"issue_type":"feature","created_at":"2025-12-12T17:26:01.293563359-05:00","updated_at":"2025-12-12T19:29:58.703325319-05:00","closed_at":"2025-12-12T19:29:58.703325319-05:00","dependencies":[{"issue_id":"queryops-pux","depends_on_id":"queryops-a05","type":"blocks","created_at":"2025-12-12T17:27:48.465642858-05:00","created_by":"daemon"}]}
{"id":"queryops-ro2","title":"Integrate CTRF test reporting in CI","description":"Add go-ctrf-json-reporter (Go tool directive), generate CTRF JSON from go test output, and publish job summary + sticky PR comment via github-test-reporter (overwrite mode).","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-20T17:22:30.720143857-05:00","updated_at":"2025-12-20T17:24:28.492214087-05:00","closed_at":"2025-12-20T17:24:28.492214087-05:00","close_reason":"Implemented CTRF Taskfile + CI workflow","comments":[{"id":1,"issue_id":"queryops-ro2","author":"ben","text":"Implemented CTRF reporting: added go-ctrf-json-reporter as go.mod tool, added Taskfile tasks tools:ctrf-reporter and test:all:ctrf emitting ctrf/unit.json + ctrf/integration.json, updated .github/workflows/tests.yml to publish job summary + overwrite sticky PR comment via ctrf-io/github-test-reporter@v1 (if: always) and added ctrf/ to .gitignore.","created_at":"2025-12-20T22:24:28Z"}]}
{"id":"queryops-s1b","title":"bd sync fails when worktree already on main","description":"Running 'bd sync' in /home/ben/source/queryops on branch main fails with: 'Error committing to sync branch: failed to create worktree: exit status 128; fatal: 'main' is already used by worktree at '/home/ben/source/queryops''. This prevents using bd sync in a single-worktree clone. Workaround: commit .beads files directly via git.","status":"closed","priority":0,"issue_type":"bug","created_at":"2025-12-11T22:07:38.502606496-05:00","updated_at":"2025-12-12T17:29:28.183473159-05:00","closed_at":"2025-12-12T17:29:28.183473159-05:00"}
{"id":"queryops-vde","title":"Create passkey handlers and routes","description":"New passkey_handlers.go with 4 endpoints: POST /passkey/register/begin (auth required), POST /passkey/register/finish (auth required), POST /passkey/login/begin (public), POST /passkey/login/finish (public). Wire up routes in routes.go.","status":"closed","priority":1,"issue_type":"task","created_at":"2025-12-12T17:26:22.47193991-05:00","updated_at":"2025-12-12T17:36:32.987776768-05:00","closed_at":"2025-12-12T17:36:32.987776768-05:00","dependencies":[{"issue_id":"queryops-vde","depends_on_id":"queryops-pn9","type":"blocks","created_at":"2025-12-12T17:27:14.903143286-05:00","created_by":"daemon"},{"issue_id":"queryops-vde","depends_on_id":"queryops-a05","type":"parent-child","created_at":"2025-12-12T17:27:23.667292724-05:00","created_by":"daemon"}]}
{"id":"queryops-we9","title":"Fix nilnil issues","description":"Address return of (nil, nil) in credential, user, and todo repositories","status":"closed","priority":0,"issue_type":"task","created_at":"2025-12-17T23:01:00.467482457-05:00","updated_at":"2025-12-17T23:19:56.267783666-05:00","closed_at":"2025-12-17T23:19:56.267783666-05:00","dependencies":[{"issue_id":"queryops-we9","depends_on_id":"queryops-8tj","type":"parent-child","created_at":"2025-12-17T23:01:03.333394742-05:00","created_by":"daemon"}]}
{"id":"queryops-wsf","title":"Switch images to Debian Trixie (no musl)","description":"Update Dockerfile runtime to debian:trixie-slim (and build stage to a glibc Go image). Also switch postgres accessory off alpine.","status":"closed","priority":1,"issue_type":"chore","created_at":"2025-12-12T21:50:44.195175631-05:00","updated_at":"2025-12-12T21:52:03.258393173-05:00","closed_at":"2025-12-12T21:52:03.258393173-05:00","dependencies":[{"issue_id":"queryops-wsf","depends_on_id":"queryops-1ox","type":"parent-child","created_at":"2025-12-12T21:50:47.047117259-05:00","created_by":"daemon"}]}
{"id":"queryops-wve","title":"Bump Postgres accessory to 18","description":"Use postgres:18-alpine in config/deploy.yml and keep README/runbook consistent.","status":"closed","priority":1,"issue_type":"chore","created_at":"2025-12-12T21:48:53.726471566-05:00","updated_at":"2025-12-12T21:49:12.289473223-05:00","closed_at":"2025-12-12T21:49:12.289473223-05:00","dependencies":[{"issue_id":"queryops-wve","depends_on_id":"queryops-1ox","type":"parent-child","created_at":"2025-12-12T21:48:58.264001332-05:00","created_by":"daemon"}]}
{"id":"queryops-x4v","title":"Fix gosec issues","description":"Address G301 (permissions), G107 (dynamic URL), and G112 (Slowloris) security concerns","status":"closed","priority":0,"issue_type":"task","created_at":"2025-12-17T23:01:00.456927701-05:00","updated_at":"2025-12-17T23:13:48.045950833-05:00","closed_at":"2025-12-17T23:13:48.045950833-05:00","dependencies":[{"issue_id":"queryops-x4v","depends_on_id":"queryops-8tj","type":"parent-child","created_at":"2025-12-17T23:01:03.323882181-05:00","created_by":"daemon"}]}
{"id":"queryops-xwt","title":"Enforce tenant scoping for hosts listing/details","description":"Multi-tenant requirement: users must only see hosts in their active organization.\n\nCurrent behavior:\n- Hosts list returns all hosts (no org filter).\n- Host details loads by host UUID with no org check.\n\nImpact: cross-organization data exposure once \u003e1 org exists.\n\nProposed fix: add org-scoped repo methods and enforce org checks in handlers; return 404 on org mismatch.\n\nTouch points: features/osquery/handlers.go, features/osquery/services/host_repository.go","status":"closed","priority":0,"issue_type":"bug","created_at":"2025-12-19T14:28:55.859967921-05:00","updated_at":"2025-12-19T14:36:09.738302112-05:00","closed_at":"2025-12-19T14:36:09.738302112-05:00","close_reason":"Closed","labels":["severity:high"]}
{"id":"queryops-xzb","title":"Add osquery agent API handler test coverage","description":"Increase test coverage for core osquery TLS backend endpoints (/osquery/*) using table-driven httptest-based handler tests. Focus on correctness of JSON parsing, node_invalid behavior, and repo/org-service call semantics without requiring Postgres by injecting stub interfaces.","design":"Refactor features/osquery Handlers to depend on small interfaces (hostRepo + orgLookup) rather than concrete *HostRepository/*OrganizationService. In tests, use stub implementations recording calls and allowing injected errors. Use chi router + httptest with JSON requests.","acceptance_criteria":"Table-driven tests cover Enroll, Config, Logger, DistributedRead, DistributedWrite branches; tests run without DB; go test ./... passes.","status":"closed","priority":1,"issue_type":"epic","created_at":"2025-12-20T16:02:57.560168186-05:00","updated_at":"2025-12-20T16:51:15.205113692-05:00","closed_at":"2025-12-20T16:51:15.205113692-05:00","close_reason":"Implemented DI-friendly osquery handlers, removed stray fmt.Println, and added httptest coverage for enroll/config/logger/distributed read+write; go test ./... passes."}
{"id":"queryops-xzb.1","title":"Refactor osquery handlers for DI-friendly interfaces","description":"Replace concrete deps in features/osquery/handlers.go (repo *services.HostRepository, orgService *OrganizationService) with minimal interfaces so handler tests can use stubs and avoid Postgres.","design":"Define interfaces in features/osquery (e.g. type hostRepo interface { GetByNodeKey; Enroll; SaveStatusLogs; SaveResultLogs; GetConfigForHost; UpdateLastConfig/Logger/Distributed; GetPendingQueries; SaveQueryResults } and type orgLookup interface { GetOrganizationByEnrollSecret }). Update Handlers struct and NewHandlers signature; update routes.go to pass concrete implementations.","acceptance_criteria":"All build passes; no behavior change; routes.go still wires concrete services; tests can instantiate Handlers with stub deps.","status":"closed","priority":1,"issue_type":"task","created_at":"2025-12-20T16:03:04.351821319-05:00","updated_at":"2025-12-20T16:51:15.197038528-05:00","closed_at":"2025-12-20T16:51:15.197038528-05:00","close_reason":"Implemented DI-friendly osquery handlers, removed stray fmt.Println, and added httptest coverage for enroll/config/logger/distributed read+write; go test ./... passes.","dependencies":[{"issue_id":"queryops-xzb.1","depends_on_id":"queryops-xzb","type":"parent-child","created_at":"2025-12-20T16:03:04.359982015-05:00","created_by":"daemon"}]}
{"id":"queryops-xzb.2","title":"Add table-driven tests for /osquery/enroll","description":"Add httptest coverage for Enroll handler. Ensure node_invalid behavior and error paths are correct.","design":"Create features/osquery/handlers_test.go (or enroll_test.go) using chi router. Use stub orgLookup + stub hostRepo. Test cases (table-driven): invalid JSON =\u003e 400; org not found (ErrOrganizationNotFound or nil org) =\u003e 200 with {node_invalid:true}; org service error =\u003e 500; success =\u003e 200 with node_key and hostRepo.Enroll called with host_identifier + host_details + orgID.","acceptance_criteria":"Tests are table-driven, deterministic, no DB. go test ./features/osquery passes.","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-20T16:03:07.883849259-05:00","updated_at":"2025-12-20T16:51:15.200445354-05:00","closed_at":"2025-12-20T16:51:15.200445354-05:00","close_reason":"Implemented DI-friendly osquery handlers, removed stray fmt.Println, and added httptest coverage for enroll/config/logger/distributed read+write; go test ./... passes.","dependencies":[{"issue_id":"queryops-xzb.2","depends_on_id":"queryops-xzb","type":"parent-child","created_at":"2025-12-20T16:03:07.891805686-05:00","created_by":"daemon"}]}
{"id":"queryops-xzb.3","title":"Add table-driven tests for /osquery/config","description":"Add httptest coverage for Config handler, including node_invalid and config passthrough.","design":"Table-driven cases: invalid JSON =\u003e 400; unknown nodeKey or repo error =\u003e node_invalid true response; UpdateLastConfig error only logs (should still return config); GetConfigForHost error =\u003e 500; valid config JSON from repo is unmarshaled into ConfigResponse and returned.","acceptance_criteria":"Covers branch behavior and JSON response shape; tests run without DB.","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-20T16:03:10.35230929-05:00","updated_at":"2025-12-20T16:51:15.201250065-05:00","closed_at":"2025-12-20T16:51:15.201250065-05:00","close_reason":"Implemented DI-friendly osquery handlers, removed stray fmt.Println, and added httptest coverage for enroll/config/logger/distributed read+write; go test ./... passes.","dependencies":[{"issue_id":"queryops-xzb.3","depends_on_id":"queryops-xzb","type":"parent-child","created_at":"2025-12-20T16:03:10.359735955-05:00","created_by":"daemon"}]}
{"id":"queryops-xzb.4","title":"Add table-driven tests for /osquery/logger","description":"Add httptest coverage for Logger handler for both status and result log types, ensuring modern osquery numeric fields parse and repo save methods are called.","design":"Table-driven cases: invalid JSON =\u003e 400; unknown nodeKey =\u003e {node_invalid:true}; log_type=status =\u003e SaveStatusLogs called per entry with line/severity numeric; log_type=result =\u003e SaveResultLogs called with name/action/columns. Use stub repo recording saves. Verify handler always returns 200 with {} unless invalid request.","acceptance_criteria":"Prevents regressions like severity unmarshalling bug; verifies calls \u0026 key fields. Tests are table-driven.","status":"closed","priority":1,"issue_type":"task","created_at":"2025-12-20T16:03:12.949610926-05:00","updated_at":"2025-12-20T16:51:15.202004046-05:00","closed_at":"2025-12-20T16:51:15.202004046-05:00","close_reason":"Implemented DI-friendly osquery handlers, removed stray fmt.Println, and added httptest coverage for enroll/config/logger/distributed read+write; go test ./... passes.","dependencies":[{"issue_id":"queryops-xzb.4","depends_on_id":"queryops-xzb","type":"parent-child","created_at":"2025-12-20T16:03:12.957460917-05:00","created_by":"daemon"}]}
{"id":"queryops-xzb.5","title":"Add table-driven tests for /osquery/distributed_read","description":"Add httptest coverage for DistributedRead handler.","design":"Cases: invalid JSON =\u003e 400; unknown nodeKey =\u003e {node_invalid:true}; GetPendingQueries error =\u003e returns {queries:{}} (node_invalid false); success =\u003e returns queries map. Stub repo returns host + queries.","acceptance_criteria":"Tests are table-driven; no DB; verifies JSON response.","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-20T16:03:14.395857341-05:00","updated_at":"2025-12-20T16:51:15.202849146-05:00","closed_at":"2025-12-20T16:51:15.202849146-05:00","close_reason":"Implemented DI-friendly osquery handlers, removed stray fmt.Println, and added httptest coverage for enroll/config/logger/distributed read+write; go test ./... passes.","dependencies":[{"issue_id":"queryops-xzb.5","depends_on_id":"queryops-xzb","type":"parent-child","created_at":"2025-12-20T16:03:14.40226593-05:00","created_by":"daemon"}]}
{"id":"queryops-xzb.6","title":"Add table-driven tests for /osquery/distributed_write","description":"Add httptest coverage for DistributedWrite handler: statuses map path vs results-only path, status handling, and invalid query IDs.","design":"Table-driven cases: invalid JSON =\u003e 400; unknown nodeKey =\u003e {node_invalid:true}; statuses empty =\u003e iterate req.Queries and SaveQueryResults status=completed; statuses present =\u003e statusCode 0 =\u003e completed; nonzero =\u003e failed + errorText 'osquery status N'; invalid UUID keys are skipped (no SaveQueryResults call). Stub repo records SaveQueryResults args.","acceptance_criteria":"Covers both branches; ensures no panics on invalid IDs; tests table-driven and deterministic.","status":"closed","priority":1,"issue_type":"task","created_at":"2025-12-20T16:03:16.584756923-05:00","updated_at":"2025-12-20T16:51:15.203611953-05:00","closed_at":"2025-12-20T16:51:15.203611953-05:00","close_reason":"Implemented DI-friendly osquery handlers, removed stray fmt.Println, and added httptest coverage for enroll/config/logger/distributed read+write; go test ./... passes.","dependencies":[{"issue_id":"queryops-xzb.6","depends_on_id":"queryops-xzb","type":"parent-child","created_at":"2025-12-20T16:03:16.593376372-05:00","created_by":"daemon"}]}
